@model string

<div class="row">
    <div class="col-md-12">
        <div class="form-inline">
            <div class="form-group">
                <button type="button" id="button_get_snake" class="btn btn-default">Get</button>
                <button type="button" id="button_save_snake" class="btn btn-default">Save</button>
                <button type="button" id="button_show_all" class="btn btn-default">Show all</button>
                <button type="button" id="button_add_chip" class="btn btn-default">Add chip</button>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div id="chip_container"></div>
    </div>
</div>
<script type="html/template" id="chip_view">
    <div class="col-md-4 chip">
        <div class="kinetic_container"></div>
        <div class="form-horizontal">
            <button type="button" id="button_insert_chip" class="btn btn-default">Insert chip</button>
            <button type="button" id="button_delete_chip" class="btn btn-default">Delete chip</button>
        </div>
    </div>
</script>

@section Scripts
{
    <script type="text/javascript">
        $(function () {
            var template = $("script#chip_view").html();

            function render(container, model) {
                container.data('model', model);

                var stage = new Kinetic.Stage({
                    container: container[0],
                    width: 300,
                    height: 70
                });

                var layer = new Kinetic.Layer();

                for (var i = 0; i < 5; i++) {
                    (function () {
                        var r = i;
                        var rect = new Kinetic.Rect({
                            x: r * 35,
                            y: 0,
                            width: 30,
                            height: 30,
                            fill: 'green'
                        });
                        rect.on('mousedown', function () {
                            model[model.length] = r;
                        });
                        layer.add(rect);
                    })();
                }

                stage.add(layer);
            };

            $('#chip_container').on('click', '#button_insert_chip', function () {
                var parent = $(this).closest('.chip');
                var $container = $(template).insertAfter(parent).find('.kinetic_container');
                render($container, []);
            });

            $('#chip_container').on('click', '#button_delete_chip', function () {
                $(this).closest('.chip').remove();
            });

            $('#button_add_chip').on('click', function () {
                var $container = $(template).appendTo("#chip_container").find('.kinetic_container');
                render($container, []);
            });

            $('#button_show_all').on('click', function () {
                var m = [];
                $('#chip_container .kinetic_container').each(function () {
                    m[m.length] = $(this).data('model');
                });
                alert(JSON.stringify(m));
            });

            $('#button_get_snake').on('click', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Snake/Get?id=' + '@Model',
                    contentType: "application/json",
                    dataType: 'json',
                    success: function (data) {
                        window.snake = data;
                        alert('data: ' + JSON.stringify(data));
                    }
                });
            });

            $('#button_save_snake').on('click', function () {
                $.ajax({
                    type: 'POST',
                    url: '/api/Snake/Save',
                    contentType: "application/json",
                    dataType: 'json',
                    data: JSON.stringify(window.snake),
                    success: function (data) {
                        window.snake = data;
                        alert('data: ' + JSON.stringify(data));
                    }
                });
            });
        });
    </script>
}
